<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Extracci√≥n y Generaci√≥n de Facturas</title>
  <link rel="stylesheet" href="/static/css/main.css">
  <link rel="stylesheet" href="/static/css/billing_extractor_n_generator.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>
    if (typeof pdfjsLib !== 'undefined') {
      pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    }
  </script>
</head>
<body>

<nav class="navbar">
  <ul>
    <li><a href="/">üè† Inicio</a></li>
  </ul>
</nav>

<div class="content">
  <div class="panel beg-panel">

    <h1 class="beg-title">üßæ Extracci√≥n y Generaci√≥n de Facturas</h1>

    <!-- Zona de carga -->
    <div class="beg-upload-zone" id="uploadZone">
      <div class="beg-upload-inner">
        <div class="beg-upload-icon">üìÇ</div>
        <div class="beg-upload-text">Arrastr√° tu Excel de facturaci√≥n ac√°</div>
        <div class="beg-upload-subtext">o hac√© clic para seleccionar el archivo (.xlsx / .xls)</div>
        <input type="file" id="fileInput" accept=".xlsx,.xls" style="display:none">
        <div class="beg-upload-buttons">
          <button type="button" class="beg-btn beg-btn-primary" id="selectFileBtn">Seleccionar archivo</button>
          <a href="/billing_extractor_n_generator/download_modelo" class="beg-btn beg-btn-secondary" download>
            üì• Descargar Excel modelo
          </a>
        </div>
        <span id="uploadedFile" class="beg-file-badge beg-hidden"></span>
      </div>
    </div>

    <!-- Controles del emisor -->
    <div class="beg-controls-row beg-hidden" id="controlsRow">
      <div class="beg-control-group">
        <label>Raz√≥n Social (Emisor)</label>
        <input type="text" id="inputEmisor" class="beg-input" placeholder="Raz√≥n Social del Emisor">
      </div>
      <div class="beg-control-group">
        <label>CUIT Emisor</label>
        <input type="text" id="inputCuit" class="beg-input" placeholder="CUIT">
      </div>
      <div class="beg-control-group">
        <label>Domicilio Comercial</label>
        <input type="text" id="inputDomicilio" class="beg-input" placeholder="Domicilio">
      </div>
      <div class="beg-control-group">
        <label>Ingresos Brutos</label>
        <input type="text" id="inputIB" class="beg-input" placeholder="Ingresos Brutos">
      </div>
      <div class="beg-control-group">
        <label>Inicio de Actividades</label>
        <input type="text" id="inputInicioAct" class="beg-input" placeholder="dd/mm/aaaa">
      </div>
      <div class="beg-control-group">
        <label>Condici√≥n IVA Emisor</label>
        <!-- Bloqueado: el valor viene del .env (emisor_cond_iva) -->
        <select id="inputCondIVA" class="beg-input beg-input-locked" disabled>
          <option value="Responsable Monotributo">Responsable Monotributo</option>
          <option value="Responsable Inscripto">Responsable Inscripto</option>
        </select>
        <span class="beg-field-note">‚öôÔ∏è Definido en configuraci√≥n</span>
      </div>
    </div>

    <!-- Botones de acci√≥n -->
    <div class="beg-button-container beg-hidden" id="actionButtons">
      <button type="button" class="beg-btn beg-btn-secondary" id="previewBtn">
        <span class="btn-text">üëÅ Vista Previa</span>
        <div class="spinner"></div>
      </button>
      <button type="button" class="beg-btn beg-btn-primary" id="generateAllBtn">
        <span class="btn-text">‚ö° Generar Todas las Facturas</span>
        <div class="spinner"></div>
      </button>
    </div>

    <!-- Mensaje de estado -->
    <div id="statusMessage" class="beg-status beg-hidden"></div>

    <!-- Tabla de vista previa -->
    <div id="previewSection" class="beg-hidden">
      <div class="beg-section-header">
        <h2>üìã Facturas a generar <span id="invoiceCount" class="beg-badge">0</span></h2>
      </div>
      <div class="beg-table-wrapper">
        <table class="beg-table" id="previewTable">
          <thead>
            <tr>
              <th>#</th>
              <th>Comp. Nro</th>
              <th>Fecha</th>
              <th>CUIT Cliente</th>
              <th>Raz√≥n Social</th>
              <th>Descripci√≥n</th>
              <th>Importe</th>
              <th>Vencimiento</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody id="previewTableBody"></tbody>
        </table>
      </div>
    </div>

    <!-- Facturas generadas -->
    <div id="generatedSection" class="beg-hidden">
      <div class="beg-section-header">
        <h2>‚úÖ Facturas Generadas</h2>
        <button type="button" class="beg-btn beg-btn-small" id="downloadAllBtn">üì¶ Descargar Todo (ZIP)</button>
      </div>
      <div id="pdfGallery" class="beg-pdf-gallery"></div>
    </div>

  </div>
</div>

<!-- Modal de factura (Vista previa PDF) -->
<div id="invoiceModal" class="beg-modal beg-hidden">
  <div class="beg-modal-content beg-modal-large">
    <div class="beg-modal-header">
      <h3 id="modalTitle">üßæ Factura</h3>
      <div class="beg-modal-actions">
        <button id="downloadInvoiceBtn" class="beg-btn beg-btn-small">‚¨áÔ∏è Descargar PDF</button>
        <button id="closeModal" class="beg-modal-close">√ó</button>
      </div>
    </div>
    <div class="beg-modal-body">
      <div id="invoiceRender"></div>
    </div>
  </div>
</div>

<script src="/static/js/billing_extractor_n_generator.js"></script>
</body>
</html>